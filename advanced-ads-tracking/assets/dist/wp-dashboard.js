(()=>{"use strict";var s={n:t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},d:(t,e)=>{for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},o:(s,t)=>Object.prototype.hasOwnProperty.call(s,t)};const t=window.jQuery;var e=s.n(t);class a{constructor(){this.classTrack=e()(".advads-performing-ads-track"),this.inpPeriod=e()("[name=advads-performing-ads-period]"),this.customFrom=e()("[name=advads-custom-from]"),this.customTo=e()("[name=advads-custom-to]"),this.adsContainer=e()("#advads-performing-container"),this.spinner=e()(".advads-spinner"),this.activeTab="",this.oldPrefs={},this.init()}enableElements(s=!0){this.classTrack.toggleClass("disabled",!s),this.inpPeriod.prop("disabled",!s),this.customFrom.prop("disabled",!s),this.customTo.prop("disabled",!s),this.spinner.toggleClass("disabled",s)}tabs(){this.classTrack.find("ul li").on("click",s=>{const t=e()(s.currentTarget);t.addClass("active").siblings().removeClass("active"),this.activeTab=t.data("tab"),e()(`.advads-performing-tab-${this.activeTab}`).addClass("active").siblings().removeClass("active"),this.saveUserPrefs()})}handlePeriodChange(){const s=e()(".advads-custom-period-wrapper");this.inpPeriod.on("change",()=>{const t={period:this.inpPeriod.val(),groupby:"day"},a="custom"===t.period;if(s.toggle(a),a){t.from=this.customFrom.val(),t.to=this.customTo.val();const s=new Date(t.from),e=new Date(t.to);if(isNaN(s.getTime())||isNaN(e.getTime())||s>e)return}const i={action:"advads_render_dashboard_ads_widget",args:e().param(t),nonce:advadsglobal.ajax_nonce};this.renderStats(i),this.classTrack.find(`[data-tab=${this.activeTab}]`).trigger("click")})}renderStats(s){e().ajax({url:ajaxurl,type:"POST",data:s,beforeSend:()=>{this.enableElements(!1),this.adsContainer.html("")},complete:()=>{this.enableElements()}}).done(s=>{this.adsContainer.html(s),e()(`.advads-performing-tab-${this.activeTab}`).addClass("active")})}saveUserPrefs(){const s={metric:this.activeTab,customFrom:this.customFrom.val(),customTo:this.customTo.val(),period:this.inpPeriod.val()};if(s.metric===this.oldPrefs.metric&&s.customFrom===this.oldPrefs.customFrom&&s.customTo===this.oldPrefs.customTo&&s.period===this.oldPrefs.period)return;this.oldPrefs.metric=s.metric,this.oldPrefs.customFrom=s.customFrom,this.oldPrefs.customTo=s.customTo,this.oldPrefs.period=s.period;const t={action:"advads_dashboard_ads_widget_user_prefs",nonce:advadsglobal.ajax_nonce,period:this.inpPeriod.val(),metric:this.activeTab,custom_from:this.customFrom.val(),custom_to:this.customTo.val()};e().ajax({url:ajaxurl,type:"POST",data:t})}getUserPrefs(){this.oldPrefs.metric=advancedAds.dashboardAdsWidget.metric,this.oldPrefs.customFrom=advancedAds.dashboardAdsWidget.customFrom,this.oldPrefs.customTo=advancedAds.dashboardAdsWidget.customTo,this.oldPrefs.period=advancedAds.dashboardAdsWidget.period,this.activeTab=this.oldPrefs.metric,this.classTrack.find(`[data-tab=${this.activeTab}]`),this.customFrom.val(this.oldPrefs.customFrom),this.customTo.val(this.oldPrefs.customTo),this.inpPeriod.val(advancedAds.dashboardAdsWidget.period).trigger("change")}handleCustomPeriod(){this.customFrom.on("change",()=>this.dateChange()),this.customTo.on("change",()=>this.dateChange())}dateChange(){const s=new Date(this.customFrom.val()),t=new Date(this.customTo.val());!isNaN(s.getTime())&&!isNaN(t.getTime())&&s<t&&this.inpPeriod.trigger("change")}init(){this.enableElements(),this.tabs(),this.handlePeriodChange(),this.handleCustomPeriod(),this.customFrom.datepicker({dateFormat:"mm/dd/yy"}),this.customTo.datepicker({dateFormat:"mm/dd/yy"}),this.getUserPrefs()}}e()(function(){new a})})();